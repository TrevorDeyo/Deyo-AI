# Use Python 3.9 as the base image
FROM python:3.9-slim

# Set the working directory
WORKDIR /app

# Install dependencies for building and FFmpeg for audio processing
RUN apt-get update && apt-get install -y \
    ffmpeg \
    build-essential \
    python3-dev \
    && rm -rf /var/lib/apt/lists/*

# Upgrade setuptools and wheel
RUN pip install --no-cache-dir --upgrade setuptools wheel

# Install dependencies for Cython, NumPy, SciPy, and PyTorch first
RUN pip install --no-cache-dir cython numpy==1.23.5 scipy
RUN pip install --no-cache-dir torch==1.10.1

# Install openai-whisper and flask (use a stable release)
RUN pip install --no-cache-dir openai-whisper flask

# Copy the application code into the container
COPY . /app

# Expose the application port (if needed for Flask)
EXPOSE 5000

# Command to run the app (you can adjust this for your setup)
CMD ["python", "stt_service.py"]
