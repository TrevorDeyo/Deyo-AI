services:
  stt_gpu:
    build:
      context: ./Whisper-STT-GPU
    ports:
      - "5002:5001"
    container_name: stt-service-gpu
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

  deepseek:
    build:
      context: ./DeepSeek # Assuming your DeepSeek Dockerfile is in a folder named DeepSeek
    ports:
      - "5000:30000" # Map host port 5000 to container port 30000 (SGLang default)
    container_name: deepseek-app
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1 # Adjust count based on your needs and the '--tp' value in your Dockerfile
              capabilities: [gpu]

  vectordb:
    build:
      context: ./VectorDB
    ports:
      - "5001:5001"
    container_name: vector-db

  nginx:
    image: nginx:latest
    container_name: nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - deepseek # Changed dependency from godel to deepseek